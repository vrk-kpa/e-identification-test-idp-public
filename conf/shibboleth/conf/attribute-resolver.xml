<?xml version="1.0" encoding="UTF-8"?>

<AttributeResolver
        xmlns="urn:mace:shibboleth:2.0:resolver"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
        xsi:schemaLocation="urn:mace:shibboleth:2.0:resolver http://shibboleth.net/schema/idp/shibboleth-attribute-resolver.xsd">

    <!-- ========================================== -->
    <!--      Attribute Definitions                 -->
    <!-- ========================================== -->

    <AttributeDefinition id="electronicIdentificationNumber" xsi:type="ScriptedAttribute">
        <AttributeEncoder xsi:type="SAML2String" name="urn:oid:1.2.246.22" friendlyName="electronicIdentificationNumber" encodeType="false" />
        <Script><![CDATA[
          authnContext = resolutionContext.getParent().getSubcontext("net.shibboleth.idp.authn.context.AuthenticationContext");
          fakeContext = authnContext.getSubcontext("fi.vm.kapa.identification.shibboleth.extauthn.context.FakeContext");
          if ( fakeContext != null && fakeContext.getSatu() != null ) {
            electronicIdentificationNumber.addValue(fakeContext.getSatu());
          }
        ]]></Script>
    </AttributeDefinition>

    <AttributeDefinition id="nationalIdentificationNumber" xsi:type="ScriptedAttribute">
        <AttributeEncoder xsi:type="SAML2String" name="urn:oid:1.2.246.21" friendlyName="nationalIdentificationNumber" encodeType="false" />
        <Script><![CDATA[
          authnContext = resolutionContext.getParent().getSubcontext("net.shibboleth.idp.authn.context.AuthenticationContext");
          fakeContext = authnContext.getSubcontext("fi.vm.kapa.identification.shibboleth.extauthn.context.FakeContext");
          if ( fakeContext != null && fakeContext.getHetu() != null ) {
            nationalIdentificationNumber.addValue(fakeContext.getHetu());
          }
        ]]></Script>
    </AttributeDefinition>

    <AttributeDefinition id="issuerCN" xsi:type="ScriptedAttribute">
        <AttributeEncoder xsi:type="SAML2String" name="urn:oid:1.2.246.517.3002.111.4" friendlyName="issuerCN" encodeType="false" />
        <Script><![CDATA[
          authnContext = resolutionContext.getParent().getSubcontext("net.shibboleth.idp.authn.context.AuthenticationContext");
          fakeContext = authnContext.getSubcontext("fi.vm.kapa.identification.shibboleth.extauthn.context.FakeContext");
          if ( fakeContext != null && fakeContext.getIssuerCN() != null ) {
            issuerCN.addValue(fakeContext.getIssuerCN());
          }
        ]]></Script>
    </AttributeDefinition>

    <AttributeDefinition id="cn" xsi:type="ScriptedAttribute">
        <AttributeEncoder xsi:type="SAML2String" name="urn:oid:2.5.4.3" friendlyName="cn" encodeType="false" />
        <Script><![CDATA[
          authnContext = resolutionContext.getParent().getSubcontext("net.shibboleth.idp.authn.context.AuthenticationContext");
          fakeContext = authnContext.getSubcontext("fi.vm.kapa.identification.shibboleth.extauthn.context.FakeContext");
          if ( fakeContext != null && fakeContext.getCn() != null ) {
            cn.addValue(fakeContext.getCn());
          }
        ]]></Script>
    </AttributeDefinition>

    <AttributeDefinition id="PersonIdentifier" xsi:type="ScriptedAttribute">
        <AttributeEncoder xsi:type="SAML2String" name="http://eidas.europa.eu/attributes/naturalperson/PersonIdentifier" friendlyName="PersonIdentifier" encodeType="false" />
        <Script><![CDATA[
          authnContext = resolutionContext.getParent().getSubcontext("net.shibboleth.idp.authn.context.AuthenticationContext");
          fakeContext = authnContext.getSubcontext("fi.vm.kapa.identification.shibboleth.extauthn.context.FakeContext");
          if ( fakeContext != null && fakeContext.getPersonIdentifier() != null ) {
            PersonIdentifier.addValue(fakeContext.getPersonIdentifier());
          }
        ]]></Script>
    </AttributeDefinition>

    <AttributeDefinition id="FirstName" xsi:type="ScriptedAttribute">
        <AttributeEncoder xsi:type="SAML2String" name="http://eidas.europa.eu/attributes/naturalperson/CurrentGivenName" friendlyName="FirstName" encodeType="false" />
        <Script><![CDATA[
          authnContext = resolutionContext.getParent().getSubcontext("net.shibboleth.idp.authn.context.AuthenticationContext");
          fakeContext = authnContext.getSubcontext("fi.vm.kapa.identification.shibboleth.extauthn.context.FakeContext");
          if ( fakeContext != null && fakeContext.getFirstName() != null ) {
            FirstName.addValue(fakeContext.getFirstName());
          }
        ]]></Script>
    </AttributeDefinition>

    <AttributeDefinition id="FamilyName" xsi:type="ScriptedAttribute">
        <AttributeEncoder xsi:type="SAML2String" name="http://eidas.europa.eu/attributes/naturalperson/CurrentFamilyName" friendlyName="FamilyName" encodeType="false" />
        <Script><![CDATA[
          authnContext = resolutionContext.getParent().getSubcontext("net.shibboleth.idp.authn.context.AuthenticationContext");
          fakeContext = authnContext.getSubcontext("fi.vm.kapa.identification.shibboleth.extauthn.context.FakeContext");
          if ( fakeContext != null && fakeContext.getFamilyName() != null ) {
            FamilyName.addValue(fakeContext.getFamilyName());
          }
        ]]></Script>
    </AttributeDefinition>

    <AttributeDefinition id="DateOfBirth" xsi:type="ScriptedAttribute">
        <AttributeEncoder xsi:type="SAML2String" name="http://eidas.europa.eu/attributes/naturalperson/DateOfBirth" friendlyName="DateOfBirth" encodeType="false" />
        <Script><![CDATA[
          authnContext = resolutionContext.getParent().getSubcontext("net.shibboleth.idp.authn.context.AuthenticationContext");
          fakeContext = authnContext.getSubcontext("fi.vm.kapa.identification.shibboleth.extauthn.context.FakeContext");
          if ( fakeContext != null && fakeContext.getDateOfBirth() != null ) {
            DateOfBirth.addValue(fakeContext.getDateOfBirth());
          }
        ]]></Script>
    </AttributeDefinition>

</AttributeResolver>